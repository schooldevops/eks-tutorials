# 마이크로서비스 어플리케이션 배포

## 샘플 코드 배포 수행하기. 

```go
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ecsdemo-nodejs
  labels:
    app: ecsdemo-nodejs
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      app: ecsdemo-nodejs
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      labels:
        app: ecsdemo-nodejs
    spec:
      containers:
        - image: brentley/ecsdemo-nodejs:latest
          imagePullPolicy: Always
          name: ecsdemo-nodejs
          ports:
            - containerPort: 3000
              protocol: TCP

```

- apiVersion: K8S 의 각 오브젝트들은 apiVersion 을 다르게 가져간다. 정식 서비스도 있고, 베타도 있기 때문에 버젼은 필수 이다. 
- kind: kind는 k8s 의 오브젝트 종류를 말한다. 여기서는 Deployment 로 파드를 배포하는 스크립트를 의미한다. 
- metadata.name: Deployment의 이름을 지정한다. 
- metadata.namespace: 디플로이될 네임스페이스 영역을 지정한다. 
- spec.replicas: Pod 복제본을 몇개 운영하려고 하는지 지정한다. 
- spec.selector ...: 어떠한 템플릿을 지정할지 결정한다. 
- spec.template: 실제 실행할 Pod의 메타 정보를 지정한다. 

즉 위 메니페스트는 ecsdemo-nodesjs 라는 디플로이 먼트를 배포하한다. 복제본은 1개이고, 컨테이너는 brentley/ecsdemo-nodejs:latest 를 실행하게 된다. 

### 샘플 코드 배포하기. 

```go
kubectl apply -f ../kubernetes/sample-application.yml
```

```go
kubectl get deploy                     

NAME             READY   UP-TO-DATE   AVAILABLE   AGE
ecsdemo-nodejs   1/1     1            1           48s
```

## Wrapup

디플로이 메니패스트를 생성하였고, 해당 서비스가 정상으로 수행되는지 확인해 보았다. 

kubectl get <object> 을 이용하여 우리가 원하는 디플로이먼트를 만들고, 배포할 수 있다. 