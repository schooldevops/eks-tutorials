# Install Tools

## aws cli 설치

가장 먼저 할 일은 AWS CLI 를 설치하는 것이다. 

eks cluster를 생성할때, aws_cli 의 profile (특정 사용의 secret을 담고 있음) 이용하고, 내부적으로 aws_cli를 이용하게 된다. 

aws cli 는 [AWS CLI설치](https://docs.aws.amazon.com/ko_kr/cli/latest/userguide/install-cliv2.html) 을 참조해서 설치하자. 

우리는 클라이언트를 macOS로 고정해서 작업을 진행할 것이므로 macOS를 선택해서 메뉴얼을 살펴보자. 

### 설치파일 다운로드 

- 최신버젼: https://awscli.amazonaws.com/AWSCLIV2.pkg 에서 다운로드 한다. 
- 특정버젼: https://awscli.amazonaws.com/AWSCLIV2-2.0.30.pkg 등과 같이 특정 버젼 파일이름을 지정해서 받을 수 있다. 

해당 pkg를 설치한다. (파일을 다운받고 더블클릭하면 된다.)

### 테스트하기. 

```go
aws --version

aws-cli/2.2.7 Python/3.8.8 Darwin/19.6.0 exe/x86_64 prompt/off
```

정상적으로 설치 되었다. aws_cli 는 2.2.7 버젼을 사용하고 있음을 알 수 있다. 

## Access Key 설치하기. 

이제 Local 환경 혹은 배포 환경에 eks-user에 대한 Access Key 를 설치하자. 

이전 아티클에서 생성하고 다운받은 access key 정보를 이용할 것이다. 

### 사전 설치된 credential 정보 확인하기. 

```go
cd ~/.aws 

ls -alt 

total 16
drwxr-xr-x+ 76 kido  staff  2432  5 31 10:45 ..
drwxr-xr-x   4 kido  staff   128  5 18 17:11 .
-rw-------   1 kido  staff   390  5 18 17:11 credentials
-rw-------   1 kido  staff   105  3 17 10:08 config
```

위와 같이 기본적으로 aws-cli 는 사용자의 home 디렉토리 내 .aws 디렉토리에 credential 을 저장하게 된다.  

#### credentials 파일 알아보기. 

credentials 파일은 access key 정보를 저장하는 곳이다. 그래서 오직 파일의 소유주만이 읽고 쓰기가 가능하게 권한이 설정된다. (이 정보는 매우 중요하므로 파일 모드를 변경하면 안된다.)

```go
cat credentials

[default]
aws_access_key_id = XXXXXXXXXXXX
aws_secret_access_key = xxxXXXxxxXXXxxx

```

형식은 위와 같다. 

- \[default\] 는 프로파일을 의미한다. aws-cli를 이용할때 profile 옵션을 지정하지 않으면 default가 사용된다. 
- aws_access_key_id: access key를 의미한다. 
- aws_secret_access_key: 접근용 secret key이다. 

#### config 파일 알아보기. 

```go
cat config

[default]
region = ap-northeast-2
output = json
```

config 파일은 위와 같이 aws-cli의 접근 리젼과, 출력 형식을 설정한다. 

- \[default\] 는 프로파일을 의미한다. aws-cli를 이용할때 profile 옵션을 지정하지 않으면 default가 사용된다. 
- region: 대상 리젼을 설정한다. ap-northeast-2 (서울이다.)
- output: 출력 형식을 지정한다. json 형식으로 출력된다. 차후 jsonpath나 jq등으로 결과를 파싱할 때 유용하다. 

#### access key config 설정하기. 

이제 access key 의 정보를 바탕으로 aws-cli 의 config를 설정하자. 

```go
aws configure --profile eks-user

AWS Access Key ID [None]: XXXXXXXXXXXX
AWS Secret Access Key [None]: xxxXXXxxxXXXxxx
Default region name [None]: ap-northeast-2
Default output format [None]: json
```

위와 같이 configure 를 지정했다. 이렇게 되면 다음과 같이 credential과 config 파일에 내용이 추가된다. 

```go
cat credentials 

[default]
aws_access_key_id = XXXXXXXXXXXX
aws_secret_access_key = xxxXXXxxxXXXxxx
[eks-user]
aws_access_key_id = XXXXXXXXXXXX
aws_secret_access_key = xxxXXXxxxXXXxxx
```

```go
cat config

[default]
region = ap-northeast-2
output = json
[profile eks-user]
region = ap-northeast-2
output = json
```

우리가 원하는 설정이 준비 되었다. 

## jq 설치하기. 

jq는 다양한 환경에 설치할 수 있는 가벼운 json 프로세서이다. 

json 구문들을 파싱하고, 필요한 값을 추출하는데 매우 유용하다. 

[jq download](https://stedolan.github.io/jq/download/) 에서 다운로드 받자. 

### mac에 설치하기. 

mac에서는 home brew 를 이용하여 설치할 것이다. 

```go
brew install jq 
```

```go
jq --version

jq-1.6
```

우리의 버젼은 1.6이 설치 되었다. 

JQ에 대해서 알고자 한다면 [jq tutorials](https://stedolan.github.io/jq/tutorial/) 에서 간단히 기능들을 확인할 수 있다. 

## kubectl 설치. 

만약 클라이언트 환경아 kubectl 이 설치되지 않았다면, https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/install-kubectl.html 에서 kubectl 을 설치하자. 

kubectl 을 이용하여 K8S 의 클러스터에 필요한 커맨드를 내릴 수 있다. 

### macOS 에 설치 

```go
curl -o kubectl https://amazon-eks.s3.us-west-2.amazonaws.com/1.19.6/2021-01-05/bin/darwin/amd64/kubectl

```


**바이너리에 권한부여**

```go
chmod +x ./kubectl
```

**path 지정**

```go
mkdir -p $HOME/bin && cp ./kubectl $HOME/bin/kubectl && export PATH=$HOME/bin:$PATH
```

```go
kubectl version --short --client
```

## eksctl 설치하기. 

[eksctl](https://eksctl.io/) 은 Amazon EKS의 공식 CLI 툴이다. 

이를 이용하여 클러스터를 생성 및 운영할 수 있다. 

### eksctl 설치

####  Linux 설치

```go
curl --silent --location "https://github.com/weaveworks/eksctl/releases/latest/download/eksctl_$(uname -s)_amd64.tar.gz" | tar xz -C /tmp
sudo mv /tmp/eksctl /usr/local/bin
```

위와 같이 tar 파일을 다운받고 압축을 해제해주면 된다. 

#### macOS 설치

우리는 macOS에서 이용할 것이기 때문에 다음과 같이 실행해주자. 

macOS에서 달라진것은 brew의 리포지토리를 등록하는 부분만 다르고, 일반적인 brew 설치로 수행된다. 

```go
brew tap weaveworks/tap
brew install weaveworks/tap/eksctl
```

```go
eksctl version

0.50.0
```

0.50.0 버젼이 설치 되었다. 

#### Shell Completion 설치하기. 

shell completion 을 설치하여, 단축기능을 화용하기 위해서 다음과 같이 해주자. 

##### bash shell

~/.bashrc 이나 ~/.bashprofile 을 열어 다음과 깉이 편집한다. 

```go
... 생략

. <(eksctl completion bash)
```

##### zsh

```go
mkdir -p ~/.zsh/completion/
eksctl completion zsh > ~/.zsh/completion/_eksctl
```

이후 ~/.zshrc 파일을 열어 다음과 같이 편집한다. 

참고: 만약 oh-my-zsh 와 같은 배포 버젼이 수행되고 있지 않다면, 자동완성을 활성화 시키기 위해서 다음과 같은 명령을 수행해주자. 

```go
autoload -U compinit
compinit
```

## WrapUp

지금까지는 기본적으로 필요한 도구들을 설치했다. 

- aws-cli 를 설치
- access key 설정
- jq 설치
- kubectl 설치
- eksctl 설치

위 과정을 수행했으므로 이제는 클러스터를 생성해 보자. 

