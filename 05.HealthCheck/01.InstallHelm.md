# Helm 패키지 관리자 설치하기. 

Helm 은 K8S 에 런치될 서비스들의 패키지를 관리하는 패키지 관리자이다. 

## Install Helm

```bash
cd 
mkdir helm && cd helm
curl https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash
cd -
```

설치 확인하기. 

```bash
helm version

version.BuildInfo{Version:"v3.6.0", GitCommit:"7f2df6467771a75f5646b7f12afb408590ed1755", GitTreeState:"clean", GoVersion:"go1.16.3"}
```

버젼 정보를 위와 같이 확인할 수 있다. 

## helm 리포지토리 등록하기. 

helm은 패키지를 저장할 리포지토리가 있으며, 이를 로컬 helm 의 리포지토리 경로를 등록해야한다. (git과 유사하게 등록이 가능하다.)

```bash
helm repo add stable https://charts.helm.sh/stable/
```

등록된 helm 확인하기. 

```bash
helm repo list

NAME    URL                          
stable  https://charts.helm.sh/stable

```

정상적으로 repository가 등록 되었음을 알 수 있다. 

## 업데이트하기. 

```bash
helm version
helm repo list
helm repo update

helm search repo
```

## Helm 으로 redis 설치해보기. 

```shell
helm install my-redis stable/redis
```

- helm install: helm으로 설치
- my-redis: 설치된 패키지의 이름이다. 
- stable/redis: 설치할 차트를 지정한다. 



결과보기 

```shell
WARNING: This chart is deprecated
NAME: my-redis
LAST DEPLOYED: Tue Jun  1 16:53:21 2021
NAMESPACE: default
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
This Helm chart is deprecated

Given the `stable` deprecation timeline (https://github.com/helm/charts#deprecation-timeline), the Bitnami maintained Redis Helm chart is now located at bitnami/charts (https://github.com/bitnami/charts/).

The Bitnami repository is already included in the Hubs and we will continue providing the same cadence of updates, support, etc that we've been keeping here these years. Installation instructions are very similar, just adding the _bitnami_ repo and using it during the installation (`bitnami/<chart>` instead of `stable/<chart>`)

```bash
$ helm repo add bitnami https://charts.bitnami.com/bitnami
$ helm install my-release bitnami/<chart>           # Helm 3
$ helm install --name my-release bitnami/<chart>    # Helm 2
```

To update an exisiting _stable_ deployment with a chart hosted in the bitnami repository you can execute
 ```bash                                                                                                                                                                                                                                                                                                                                                                    $ helm
 repo add bitnami https://charts.bitnami.com/bitnami
  $ helm upgrade my-release bitnami/<chart>
  ```

  Issues and PRs related to the chart itself will be redirected to `bitnami/charts` GitHub repository. In the same way, we'll be happy to answer questions related to this migration process in this issue (https://github.com/helm/charts/issues/20969) created as a common place for discussion.

** Please be patient while the chart is being deployed **
Redis can be accessed via port 6379 on the following DNS names from within your cluster:

my-redis-master.default.svc.cluster.local for read/write operations
my-redis-slave.default.svc.cluster.local for read-only operations


To get your password run:

    export REDIS_PASSWORD=$(kubectl get secret --namespace default my-redis -o jsonpath="{.data.redis-password}" | base64 --decode)

To connect to your Redis server:

1. Run a Redis pod that you can use as a client:

   kubectl run --namespace default my-redis-client --rm --tty -i --restart='Never' \
    --env REDIS_PASSWORD=$REDIS_PASSWORD \
   --image docker.io/bitnami/redis:5.0.7-debian-10-r32 -- bash

2. Connect using the Redis CLI:
   redis-cli -h my-redis-master -a $REDIS_PASSWORD
   redis-cli -h my-redis-slave -a $REDIS_PASSWORD

To connect to your database from outside the cluster execute the following commands:

    kubectl port-forward --namespace default svc/my-redis-master 6379:6379 &
    redis-cli -h 127.0.0.1 -p 6379 -a $REDIS_PASSWORD
```

### 설치 목록 보기. 

```go
helm ls

NAME            NAMESPACE       REVISION        UPDATED                                 STATUS          CHART           APP VERSION
my-redis        default         1               2021-06-01 16:53:21.951221 +0900 KST    deployed        redis-10.5.7    5.0.7 
```

### 삭제하기. 

```shell
helm uninstall my-redis

release "my-redis" uninstalled
```